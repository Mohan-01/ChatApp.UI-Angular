<form
  class="d-none d-lg-flex me-3 position-relative me-auto"
  role="search"
  (submit)="onSearchUsers()"
>
  <input
    class="form-control"
    type="search"
    placeholder="Search..."
    aria-label="Search"
    [(ngModel)]="searchTerm"
    name="search"
    (input)="onSearchUsers()"
  />
</form>

<!-- Search icon for mobile -->
<li class="nav-item d-lg-none">
  <a class="nav-link" (click)="toggleSearchMobile()">
    <i class="bi bi-search"></i>
  </a>
</li>

<!-- 🔍 DESKTOP DROPDOWN RESULTS -->
<div
  class="dropdown-menu w-100 p-3 mt-2 position-absolute z-3 d-none d-lg-block"
  [class.show]="isMobileSearchActive"
  style="max-height: 300px; overflow-y: auto"
>
  <ng-container *ngIf="searchResults.length > 0">
    <div
      *ngFor="let user of searchResults"
      class="dropdown-item d-flex justify-content-between align-items-center"
    >
      <ng-container *ngIf="user.username !== currentUsername">
        <div class="d-flex align-items-center">
          <img
            [src]="user.profilePicture || 'assets/default-avatar.png'"
            alt="Profile"
            class="me-2 rounded-circle"
            style="width: 40px; height: 40px"
          />
          <div>
            <strong>{{ user.firstName }} {{ user.lastName }}</strong
            ><br />
            <small class="text-muted">{{ "@" }} {{ user.username }}</small>
          </div>
        </div>
        <button
          class="btn btn-sm btn-outline-primary"
          (click)="getChatByUsername(user.username)"
        >
          Message
        </button>
      </ng-container>
    </div>
  </ng-container>
  <ng-template #noResults>
    <div class="text-muted">No users found.</div>
  </ng-template>
</div>

<!-- 🔍 MOBILE FULLSCREEN RESULTS -->
<div
  class="position-fixed top-0 start-0 w-100 h-100 bg-white p-3 overflow-auto d-lg-none z-3"
  *ngIf="isMobileSearchActive"
  style="z-index: 1055"
>
  <!-- Close button for mobile -->
  <div class="text-end mb-3">
    <button
      class="btn-close"
      aria-label="Close"
      (click)="isMobileSearchActive = false"
    ></button>
  </div>

  <ng-container *ngIf="searchResults.length > 0">
    <div
      *ngFor="let user of searchResults"
      class="border-bottom pb-2 mb-2 d-flex justify-content-between align-items-center"
    >
      <ng-container *ngIf="user.username !== currentUsername">
        <div class="d-flex align-items-center">
          <img
            [src]="user.profilePicture || 'assets/default-avatar.png'"
            alt="Profile"
            class="me-2 rounded-circle"
            style="width: 50px; height: 50px"
          />
          <div>
            <h6 class="mb-0">{{ user.firstName }} {{ user.lastName }}</h6>
            <small class="text-muted">{{ "@" }}{{ user.username }}</small>
          </div>
        </div>
        <button
          class="btn btn-sm btn-outline-primary"
          (click)="getChatByUsername(user.username)"
        >
          Message
        </button>
      </ng-container>
    </div>
  </ng-container>

  <ng-template #noMobileResults>
    <div class="text-muted">No users found.</div>
  </ng-template>
</div>
